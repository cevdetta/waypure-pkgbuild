# Maintainer: cevdetta
# Contributor: cevdetta

pkgname=wlroots-waypure
pkgver=0.19.2
pkgrel=1
pkgdesc="Modular Wayland compositor library without X"
arch=('x86_64')
url="https://gitlab.freedesktop.org/wlroots/wlroots"
license=('MIT')
depends=('glibc' 'lcms2' 'libdisplay-info' 'libdrm' 'libinput' 'libliftoff' 'libxkbcommon' 'mesa' 'pixman' 'seatd' 'systemd-libs' 'vulkan-icd-loader' 'wayland')
makedepends=('glslang' 'meson' 'systemd' 'vulkan-headers' 'wayland-protocols')
provides=("libwlroots-${pkgver%.*}.so" "${pkgname%%-*}0.19")
conflicts=("${pkgname%%-*}0.19")
replaces=("${pkgname%%-*}0.19")
source=("$url/-/releases/$pkgver/downloads/${pkgname%%-*}-$pkgver.tar.gz")
sha256sums=('09a0a8d60104c8b0772fee4f60ba76a89aed7e59dff7659d00960fba06bdf267')

build() {
  local _meson_options=(
    --buildtype=release
    --auto-features=disabled
    -Dstrip=true
    -Db_lto=true
    -Db_ndebug=true

    -D werror=false

    -Dxcb-errors=disabled
    -Dxwayland=disabled
    -Dexamples=false
    # -Dicon_directory=''
    -Drenderers=vulkan
    -Dbackends=drm,libinput
    -Dallocators=gbm,udmabuf
    -Dsession=enabled
    -Dcolor-management=enabled
    -Dlibliftoff=enabled
  )

  arch-meson "${pkgname%%-*}-$pkgver" build "${_meson_options[@]}"

  meson compile -C build
}

package() {
  DESTDIR="$pkgdir" meson install -C build
  install -Dm644 "${pkgname%%-*}-$pkgver/LICENSE" -t "$pkgdir/usr/share/licenses/$pkgname"
}
